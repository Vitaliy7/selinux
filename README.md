# selinux
## Домашнее задание по теме _SELinux - когда все запрещено_

>1.Запустить nginx на нестандартном порту 3-мя разными способами:  
>> * переключатели setsebool;  
>> * добавление нестандартного порта в имеющийся тип;  
>> * формирование и установка модуля SELinux.  
>> * К сдаче:
README с описанием каждого решения (скриншоты и демонстрация приветствуются).  


>2.Обеспечить работоспособность приложения при включенном selinux.  
>> * развернуть приложенный стенд https://github.com/mbfx/otus-linux-adm/tree/master/selinux_dns_problems;
>> * выяснить причину неработоспособности механизма обновления зоны (см. README);
>> * предложить решение (или решения) для данной проблемы;
>> * выбрать одно из решений для реализации, предварительно обосновав выбор;
>> * реализовать выбранное решение и продемонстрировать его работоспособность.
>> * К сдаче:  
README с анализом причины неработоспособности, возможными способами решения и обоснованием выбора одного из них;  
исправленный стенд или демонстрация работоспособной системы скриншотами и описанием.

## Решение ДЗ

#### 1. Запустить nginx на нестандартном порту 3-мя разными способами:  

#### 2. Обеспечить работоспособность приложения при включенном selinux.  

Скачиваем данные из репозитория `git clone https://github.com/mbfx/otus-linux-adm.git`

Запускаем наши виртуальные машины, подключаемся к клиентской машине и пробуем внести изменения в зону.
Изменить не получилось( Смотрим логи selinux с помощью утилиты `audit2why`, чтобы понять источник проблемы. На клиенте ошибок нет:

![](https://github.com/Vitaliy7/selinux/blob/main/client1.png?raw=true)

Теперь, не отключаясь от клиента, подключаемся к серверу и проверяем логи selinux при помощи той же `audit2why`
Из логов становится ясно, что ошибка в контексте безопасности, т.к. у нас вместо типа `named_t` используется `etc_t`, затем смотрим каталог `/etc/named`
Проблема заключается в том, что конфигурационные файлы лежат в другом каталоге. Смотрим, в каком каталоги должны лежать файлы, чтобы на них распространялись правильные политики selinux:

![](https://github.com/Vitaliy7/selinux/blob/main/server1.png?raw=true)

Изменим тип контекста безопасности для каталога `/etc/named` и проверяем его:

![](https://github.com/Vitaliy7/selinux/blob/main/server2.png?raw=true)

Опять заходим на клиента и пробуем снова внести изменения. Видим, что на этот раз получилось): 

![](https://github.com/Vitaliy7/selinux/blob/main/client2.png?raw=true)

Перезагружаем хосты и еще раз делаем запрос с помощью инструмента для опроса DNS-серверов `dig`:

сервер

![](https://github.com/Vitaliy7/selinux/blob/main/server3.png?raw=true)

клиент

![](https://github.com/Vitaliy7/selinux/blob/main/client3.png?raw=true)

Как видим, после перезагрузки настройки сохранились.
